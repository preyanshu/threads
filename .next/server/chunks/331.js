"use strict";exports.id=331,exports.ids=[331],exports.modules={47125:(e,t,a)=>{a.r(t),a.d(t,{default:()=>n});var r=a(95344),i=a(41223),d=a.n(i),s=a(22254),l=a(40152);let n=function({threadId:e,currentUserId:t,authorId:a,parentId:i,isComment:n}){let c=(0,s.usePathname)(),o=(0,s.useRouter)();return t!==a||"/"===c?null:r.jsx(d(),{src:"/assets/delete.svg",alt:"delte",width:18,height:18,className:"cursor-pointer object-contain",onClick:async()=>{await (0,l.l8)(JSON.parse(e),c),i&&n||o.push("/")}})}},40152:(e,t,a)=>{a.d(t,{Ho:()=>i,gK:()=>d,l8:()=>s}),a(13664);var r=a(28371),i=(0,r.$)("6c43d88ae8971d644bac3e238c27c4174aed9a8b");(0,r.$)("7dab10352a8648ac19256d750c384fc5df404edf");var d=(0,r.$)("927139672bcde43876d6d45f34b0278362ff1819"),s=(0,r.$)("99bef74b7d73cf06e04d005b22478077a45eba3c");(0,r.$)("efb38be62ab00719db57928149e6461da7be13bc")},25763:(e,t,a)=>{a.d(t,{Z:()=>u});var r=a(25036),i=a(15904),d=a.n(i),s=a(40646),l=a.n(s),n=a(95752);let c=(0,a(86843).createProxy)(String.raw`C:\Users\pmish\Desktop\threads\components\forms\DeleteThread.tsx`),{__esModule:o,$$typeof:h}=c,m=c.default,u=function({id:e,currentUserId:t,parentId:a,content:i,author:s,community:c,createdAt:o,comments:h,isComment:u}){return(0,r.jsxs)("article",{className:`flex w-full flex-col rounded-xl ${u?"px-0 xs:px-7":"bg-dark-2 p-7"}`,children:[(0,r.jsxs)("div",{className:"flex items-start justify-between",children:[(0,r.jsxs)("div",{className:"flex w-full flex-1 flex-row gap-4",children:[(0,r.jsxs)("div",{className:"flex flex-col items-center",children:[r.jsx(l(),{href:`/profile/${s.id}`,className:"relative h-11 w-11",children:r.jsx(d(),{src:s.image,alt:"user_community_image",fill:!0,className:"cursor-pointer rounded-full"})}),r.jsx("div",{className:"thread-card_bar"})]}),(0,r.jsxs)("div",{className:"flex w-full flex-col",children:[r.jsx(l(),{href:`/profile/${s.id}`,className:"w-fit",children:r.jsx("h4",{className:"cursor-pointer text-base-semibold text-light-1",children:s.name})}),r.jsx("p",{className:"mt-2 text-small-regular text-light-2",children:i}),(0,r.jsxs)("div",{className:`${u&&"mb-10"} mt-5 flex flex-col gap-3`,children:[(0,r.jsxs)("div",{className:"flex gap-3.5",children:[r.jsx(d(),{src:"/assets/heart-gray.svg",alt:"heart",width:24,height:24,className:"cursor-pointer object-contain"}),r.jsx(l(),{href:`/thread/${e}`,children:r.jsx(d(),{src:"/assets/reply.svg",alt:"heart",width:24,height:24,className:"cursor-pointer object-contain"})}),r.jsx(d(),{src:"/assets/repost.svg",alt:"heart",width:24,height:24,className:"cursor-pointer object-contain"}),r.jsx(d(),{src:"/assets/share.svg",alt:"heart",width:24,height:24,className:"cursor-pointer object-contain"})]}),u&&h.length>0&&r.jsx(l(),{href:`/thread/${e}`,children:(0,r.jsxs)("p",{className:"mt-1 text-subtle-medium text-gray-1",children:[h.length," repl",h.length>1?"ies":"y"]})})]})]})]}),r.jsx(m,{threadId:JSON.stringify(e),currentUserId:t,authorId:s.id,parentId:a,isComment:u})]}),!u&&h.length>0&&(0,r.jsxs)("div",{className:"ml-1 mt-3 flex items-center gap-2",children:[h.slice(0,2).map((e,t)=>r.jsx(d(),{src:e.author.image,alt:`user_${t}`,width:24,height:24,className:`${0!==t&&"-ml-5"} rounded-full object-cover`},t)),r.jsx(l(),{href:`/thread/${e}`,children:(0,r.jsxs)("p",{className:"mt-1 text-subtle-medium text-gray-1",children:[h.length," repl",h.length>1?"ies":"y"]})})]}),!u&&c&&(0,r.jsxs)(l(),{href:`/communities/${c.id}`,className:"mt-5 flex items-center",children:[(0,r.jsxs)("p",{className:"text-subtle-medium text-gray-1",children:[(0,n.ie)(o),c&&` - ${c.name} Community`]}),r.jsx(d(),{src:c.image,alt:c.name,width:14,height:14,className:"ml-1 rounded-full object-cover"})]})]})}},54740:(e,t,a)=>{a.r(t),a.d(t,{addCommentToThread:()=>f,createThread:()=>o,deleteThread:()=>m,fetchPosts:()=>c,fetchThreadById:()=>u});var r=a(74471);a(68616);var i=a(66864),d=a(84316),s=a(67641),l=a(4577),n=a(22892);async function c(e=1,t=20){(0,d.P)();let a=(e-1)*t,r=l.Z.find({parentId:{$in:[null,void 0]}}).sort({createdAt:"desc"}).skip(a).limit(t).populate({path:"author",model:s.Z}).populate({path:"community",model:n.Z}).populate({path:"children",populate:{path:"author",model:s.Z,select:"_id name parentId image"}}),i=await l.Z.countDocuments({parentId:{$in:[null,void 0]}}),c=await r.exec(),o=i>a+c.length;return{posts:c,isNext:o}}async function o({text:e,author:t,communityId:a,path:r}){try{(0,d.P)();let c=await n.Z.findOne({id:a},{_id:1}),o=await l.Z.create({text:e,author:t,community:c});await s.Z.findByIdAndUpdate(t,{$push:{threads:o._id}}),c&&await n.Z.findByIdAndUpdate(c,{$push:{threads:o._id}}),(0,i.revalidatePath)(r)}catch(e){throw Error(`Failed to create thread: ${e.message}`)}}async function h(e){let t=await l.Z.find({parentId:e}),a=[];for(let e of t){let t=await h(e._id);a.push(e,...t)}return a}async function m(e,t){try{(0,d.P)();let a=await l.Z.findById(e).populate("author community");if(!a)throw Error("Thread not found");let r=await h(e),c=[e,...r.map(e=>e._id)],o=new Set([...r.map(e=>e.author?._id?.toString()),a.author?._id?.toString()].filter(e=>void 0!==e)),m=new Set([...r.map(e=>e.community?._id?.toString()),a.community?._id?.toString()].filter(e=>void 0!==e));await l.Z.deleteMany({_id:{$in:c}}),await s.Z.updateMany({_id:{$in:Array.from(o)}},{$pull:{threads:{$in:c}}}),await n.Z.updateMany({_id:{$in:Array.from(m)}},{$pull:{threads:{$in:c}}}),(0,i.revalidatePath)(t)}catch(e){throw Error(`Failed to delete thread: ${e.message}`)}}async function u(e){(0,d.P)();try{return await l.Z.findById(e).populate({path:"author",model:s.Z,select:"_id id name image"}).populate({path:"community",model:n.Z,select:"_id id name image"}).populate({path:"children",populate:[{path:"author",model:s.Z,select:"_id id name parentId image"},{path:"children",model:l.Z,populate:{path:"author",model:s.Z,select:"_id id name parentId image"}}]}).exec()}catch(e){throw console.error("Error while fetching thread:",e),Error("Unable to fetch thread")}}async function f(e,t,a,r){(0,d.P)();try{let d=await l.Z.findById(e);if(!d)throw Error("Thread not found");let s=new l.Z({text:t,author:a,parentId:e}),n=await s.save();d.children.push(n._id),await d.save(),(0,i.revalidatePath)(r)}catch(e){throw console.error("Error while adding comment:",e),Error("Unable to add comment")}}(0,a(42053).h)([c,o,m,u,f]),(0,r.U)("7dab10352a8648ac19256d750c384fc5df404edf",c),(0,r.U)("927139672bcde43876d6d45f34b0278362ff1819",o),(0,r.U)("99bef74b7d73cf06e04d005b22478077a45eba3c",m),(0,r.U)("efb38be62ab00719db57928149e6461da7be13bc",u),(0,r.U)("6c43d88ae8971d644bac3e238c27c4174aed9a8b",f)},95752:(e,t,a)=>{a.d(t,{cn:()=>d,ie:()=>s});var r=a(70990),i=a(81774);function d(...e){return(0,i.m6)((0,r.W)(e))}function s(e){let t=new Date(e),a=t.toLocaleDateString(void 0,{year:"numeric",month:"short",day:"numeric"}),r=t.toLocaleTimeString([],{hour:"numeric",minute:"2-digit"});return`${r} - ${a}`}}};