(()=>{var e={};e.id=572,e.ids=[572],e.modules={11185:e=>{"use strict";e.exports=require("mongoose")},47849:e=>{"use strict";e.exports=require("next/dist/client/components/action-async-storage.external")},55403:e=>{"use strict";e.exports=require("next/dist/client/components/request-async-storage.external")},94749:e=>{"use strict";e.exports=require("next/dist/client/components/static-generation-async-storage.external")},20399:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},25528:e=>{"use strict";e.exports=require("next/dist\\client\\components\\action-async-storage.external.js")},91877:e=>{"use strict";e.exports=require("next/dist\\client\\components\\request-async-storage.external.js")},25319:e=>{"use strict";e.exports=require("next/dist\\client\\components\\static-generation-async-storage.external.js")},14300:e=>{"use strict";e.exports=require("buffer")},6113:e=>{"use strict";e.exports=require("crypto")},57147:e=>{"use strict";e.exports=require("fs")},72254:e=>{"use strict";e.exports=require("node:buffer")},6005:e=>{"use strict";e.exports=require("node:crypto")},87561:e=>{"use strict";e.exports=require("node:fs")},88849:e=>{"use strict";e.exports=require("node:http")},22286:e=>{"use strict";e.exports=require("node:https")},87503:e=>{"use strict";e.exports=require("node:net")},49411:e=>{"use strict";e.exports=require("node:path")},97742:e=>{"use strict";e.exports=require("node:process")},84492:e=>{"use strict";e.exports=require("node:stream")},72477:e=>{"use strict";e.exports=require("node:stream/web")},41041:e=>{"use strict";e.exports=require("node:url")},47261:e=>{"use strict";e.exports=require("node:util")},65628:e=>{"use strict";e.exports=require("node:zlib")},71017:e=>{"use strict";e.exports=require("path")},77282:e=>{"use strict";e.exports=require("process")},12781:e=>{"use strict";e.exports=require("stream")},57310:e=>{"use strict";e.exports=require("url")},71267:e=>{"use strict";e.exports=require("worker_threads")},59796:e=>{"use strict";e.exports=require("zlib")},15828:(e,t,r)=>{"use strict";r.r(t),r.d(t,{GlobalError:()=>s.a,__next_app__:()=>u,originalPathname:()=>f,pages:()=>l,routeModule:()=>m,tree:()=>c});var a=r(50482),d=r(69108),n=r(62563),s=r.n(n),i=r(68300),o={};for(let e in i)0>["default","tree","pages","GlobalError","originalPathname","__next_app__","routeModule"].indexOf(e)&&(o[e]=()=>i[e]);r.d(t,o);let c=["",{children:["(root)",{children:["create-thread",{children:["__PAGE__",{},{page:[()=>Promise.resolve().then(r.bind(r,31380)),"C:\\Users\\pmish\\Desktop\\threads\\app\\(root)\\create-thread\\page.tsx"]}]},{}]},{layout:[()=>Promise.resolve().then(r.bind(r,42313)),"C:\\Users\\pmish\\Desktop\\threads\\app\\(root)\\layout.tsx"],"not-found":[()=>Promise.resolve().then(r.t.bind(r,69361,23)),"next/dist/client/components/not-found-error"],metadata:{icon:[async e=>(await Promise.resolve().then(r.bind(r,57481))).default(e)],apple:[],openGraph:[],twitter:[],manifest:void 0}}]},{"not-found":[()=>Promise.resolve().then(r.t.bind(r,69361,23)),"next/dist/client/components/not-found-error"],metadata:{icon:[async e=>(await Promise.resolve().then(r.bind(r,57481))).default(e)],apple:[],openGraph:[],twitter:[],manifest:void 0}}],l=["C:\\Users\\pmish\\Desktop\\threads\\app\\(root)\\create-thread\\page.tsx"],f="/(root)/create-thread/page",u={require:r,loadChunk:()=>Promise.resolve()},m=new a.AppPageRouteModule({definition:{kind:d.x.APP_PAGE,page:"/(root)/create-thread/page",pathname:"/create-thread",bundlePath:"",filename:"",appPaths:[]},userland:{loaderTree:c}})},26353:(e,t,r)=>{let a={"6c43d88ae8971d644bac3e238c27c4174aed9a8b":()=>Promise.resolve().then(r.bind(r,98268)).then(e=>e.addCommentToThread),"7dab10352a8648ac19256d750c384fc5df404edf":()=>Promise.resolve().then(r.bind(r,98268)).then(e=>e.fetchPosts),"927139672bcde43876d6d45f34b0278362ff1819":()=>Promise.resolve().then(r.bind(r,98268)).then(e=>e.createThread),"99bef74b7d73cf06e04d005b22478077a45eba3c":()=>Promise.resolve().then(r.bind(r,98268)).then(e=>e.deleteThread),efb38be62ab00719db57928149e6461da7be13bc:()=>Promise.resolve().then(r.bind(r,98268)).then(e=>e.fetchThreadById)};async function d(e,...t){return(await a[e]()).apply(null,t)}e.exports={"6c43d88ae8971d644bac3e238c27c4174aed9a8b":d.bind(null,"6c43d88ae8971d644bac3e238c27c4174aed9a8b"),"7dab10352a8648ac19256d750c384fc5df404edf":d.bind(null,"7dab10352a8648ac19256d750c384fc5df404edf"),"927139672bcde43876d6d45f34b0278362ff1819":d.bind(null,"927139672bcde43876d6d45f34b0278362ff1819"),"99bef74b7d73cf06e04d005b22478077a45eba3c":d.bind(null,"99bef74b7d73cf06e04d005b22478077a45eba3c"),efb38be62ab00719db57928149e6461da7be13bc:d.bind(null,"efb38be62ab00719db57928149e6461da7be13bc")}},5591:(e,t,r)=>{let a={"3fd262308cbd4d8cfe123ed7d8f55123cd218dfb":()=>Promise.resolve().then(r.bind(r,86840)).then(e=>e.updateUser),b09bfeec4770447ecdf478eac2d39128284ff186:()=>Promise.resolve().then(r.bind(r,86840)).then(e=>e.getActivity),be41f9407caed4a3164b39630c9189fad7727fd5:()=>Promise.resolve().then(r.bind(r,86840)).then(e=>e.fetchUser),c6244d191c17a16014b50f3f4fde03481a153006:()=>Promise.resolve().then(r.bind(r,86840)).then(e=>e.fetchUserPosts),ec252860ac9162ddfbe1ea04f72f708c3300c036:()=>Promise.resolve().then(r.bind(r,86840)).then(e=>e.fetchUsers),"0da0104d7dba8790a8b124806ed952154af8918d":()=>Promise.resolve().then(r.bind(r,62758)).then(e=>e.removeUserFromCommunity),"2adc94148f09bbe7c9f5d372115a34ad0e86492b":()=>Promise.resolve().then(r.bind(r,62758)).then(e=>e.createCommunity),"36b1f1bff49b8e737400c116883ce5836c213a82":()=>Promise.resolve().then(r.bind(r,62758)).then(e=>e.fetchCommunities),"8356855c215e99352469e961aa11611023d1f252":()=>Promise.resolve().then(r.bind(r,62758)).then(e=>e.fetchCommunityDetails),"884f460cd0c0f18401c5fe05b61a731c0c5cb209":()=>Promise.resolve().then(r.bind(r,62758)).then(e=>e.addMemberToCommunity),b7d9f3564e437134e6f9276cf9cf726f95971d90:()=>Promise.resolve().then(r.bind(r,62758)).then(e=>e.fetchCommunityPosts),c0c5d611f5d1e9c0f1671c44ec0cd6a6c56e9690:()=>Promise.resolve().then(r.bind(r,62758)).then(e=>e.updateCommunityInfo),e203ae2f7a9b8e132ed9b06224224015081d7d1e:()=>Promise.resolve().then(r.bind(r,62758)).then(e=>e.deleteCommunity)};async function d(e,...t){return(await a[e]()).apply(null,t)}e.exports={"3fd262308cbd4d8cfe123ed7d8f55123cd218dfb":d.bind(null,"3fd262308cbd4d8cfe123ed7d8f55123cd218dfb"),b09bfeec4770447ecdf478eac2d39128284ff186:d.bind(null,"b09bfeec4770447ecdf478eac2d39128284ff186"),be41f9407caed4a3164b39630c9189fad7727fd5:d.bind(null,"be41f9407caed4a3164b39630c9189fad7727fd5"),c6244d191c17a16014b50f3f4fde03481a153006:d.bind(null,"c6244d191c17a16014b50f3f4fde03481a153006"),ec252860ac9162ddfbe1ea04f72f708c3300c036:d.bind(null,"ec252860ac9162ddfbe1ea04f72f708c3300c036"),"0da0104d7dba8790a8b124806ed952154af8918d":d.bind(null,"0da0104d7dba8790a8b124806ed952154af8918d"),"2adc94148f09bbe7c9f5d372115a34ad0e86492b":d.bind(null,"2adc94148f09bbe7c9f5d372115a34ad0e86492b"),"36b1f1bff49b8e737400c116883ce5836c213a82":d.bind(null,"36b1f1bff49b8e737400c116883ce5836c213a82"),"8356855c215e99352469e961aa11611023d1f252":d.bind(null,"8356855c215e99352469e961aa11611023d1f252"),"884f460cd0c0f18401c5fe05b61a731c0c5cb209":d.bind(null,"884f460cd0c0f18401c5fe05b61a731c0c5cb209"),b7d9f3564e437134e6f9276cf9cf726f95971d90:d.bind(null,"b7d9f3564e437134e6f9276cf9cf726f95971d90"),c0c5d611f5d1e9c0f1671c44ec0cd6a6c56e9690:d.bind(null,"c0c5d611f5d1e9c0f1671c44ec0cd6a6c56e9690"),e203ae2f7a9b8e132ed9b06224224015081d7d1e:d.bind(null,"e203ae2f7a9b8e132ed9b06224224015081d7d1e")}},79447:(e,t,r)=>{Promise.resolve().then(r.bind(r,61783)),Promise.resolve().then(r.bind(r,38085)),Promise.resolve().then(r.bind(r,65102)),Promise.resolve().then(r.bind(r,22315)),Promise.resolve().then(r.bind(r,34910))},61783:(e,t,r)=>{"use strict";r.r(t),r.d(t,{default:()=>m});var a=r(95344),d=r(60708),n=r(85523),s=r(85453),i=r(22254),o=r(78767),c=r(16212),l=r(93601),f=r(12634),u=r(40152);let m=function({userId:e}){let t=(0,i.useRouter)(),r=(0,i.usePathname)(),{organization:m}=(0,n.o8)(),b=(0,d.cI)({resolver:(0,s.F)(f.f),defaultValues:{thread:"",accountId:e}}),p=async a=>{await (0,u.gK)({text:a.thread,author:e,communityId:m?m.id:null,path:r}),t.push("/")};return a.jsx(o.l0,{...b,children:(0,a.jsxs)("form",{className:"mt-10 flex flex-col justify-start gap-10",onSubmit:b.handleSubmit(p),children:[a.jsx(o.Wi,{control:b.control,name:"thread",render:({field:e})=>(0,a.jsxs)(o.xJ,{className:"flex w-full flex-col gap-3",children:[a.jsx(o.lX,{className:"text-base-semibold text-light-2",children:"Content"}),a.jsx(o.NI,{className:"no-focus border border-dark-4 bg-dark-3 text-light-1",children:a.jsx(l.g,{rows:15,...e})}),a.jsx(o.zG,{})]})}),a.jsx(c.z,{type:"submit",className:"bg-primary-500",children:"Post Thread"})]})})}},78767:(e,t,r)=>{"use strict";r.d(t,{l0:()=>f,NI:()=>y,Wi:()=>m,xJ:()=>h,lX:()=>x,zG:()=>g});var a=r(95344),d=r(3729),n=r(32751),s=r(60708),i=r(91626),o=r(14217);let c=(0,r(88720).j)("text-sm font-medium leading-none peer-disabled:cursor-not-allowed peer-disabled:opacity-70"),l=d.forwardRef(({className:e,...t},r)=>a.jsx(o.f,{ref:r,className:(0,i.cn)(c(),e),...t}));l.displayName=o.f.displayName;let f=s.RV,u=d.createContext({}),m=({...e})=>a.jsx(u.Provider,{value:{name:e.name},children:a.jsx(s.Qr,{...e})}),b=()=>{let e=d.useContext(u),t=d.useContext(p),{getFieldState:r,formState:a}=(0,s.Gc)(),n=r(e.name,a);if(!e)throw Error("useFormField should be used within <FormField>");let{id:i}=t;return{id:i,name:e.name,formItemId:`${i}-form-item`,formDescriptionId:`${i}-form-item-description`,formMessageId:`${i}-form-item-message`,...n}},p=d.createContext({}),h=d.forwardRef(({className:e,...t},r)=>{let n=d.useId();return a.jsx(p.Provider,{value:{id:n},children:a.jsx("div",{ref:r,className:(0,i.cn)("space-y-2",e),...t})})});h.displayName="FormItem";let x=d.forwardRef(({className:e,...t},r)=>{let{error:d,formItemId:n}=b();return a.jsx(l,{ref:r,className:(0,i.cn)(d&&"text-red-500 dark:text-red-900",e),htmlFor:n,...t})});x.displayName="FormLabel";let y=d.forwardRef(({...e},t)=>{let{error:r,formItemId:d,formDescriptionId:s,formMessageId:i}=b();return a.jsx(n.g7,{ref:t,id:d,"aria-describedby":r?`${s} ${i}`:`${s}`,"aria-invalid":!!r,...e})});y.displayName="FormControl",d.forwardRef(({className:e,...t},r)=>{let{formDescriptionId:d}=b();return a.jsx("p",{ref:r,id:d,className:(0,i.cn)("text-sm text-slate-500 dark:text-slate-400",e),...t})}).displayName="FormDescription";let g=d.forwardRef(({className:e,children:t,...r},d)=>{let{error:n,formMessageId:s}=b(),o=n?String(n?.message):t;return o?a.jsx("p",{ref:d,id:s,className:(0,i.cn)("text-sm font-medium text-red-500 dark:text-red-900",e),...r,children:o}):null});g.displayName="FormMessage"},93601:(e,t,r)=>{"use strict";r.d(t,{g:()=>s});var a=r(95344),d=r(3729),n=r(91626);let s=d.forwardRef(({className:e,...t},r)=>a.jsx("textarea",{className:(0,n.cn)("flex min-h-[80px] w-full rounded-md border border-slate-200 bg-white px-3 py-2 text-sm ring-offset-white placeholder:text-slate-500 focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-slate-950 focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 dark:border-slate-800 dark:bg-slate-950 dark:ring-offset-slate-950 dark:placeholder:text-slate-400 dark:focus-visible:ring-slate-300",e),ref:r,...t}));s.displayName="Textarea"},40152:(e,t,r)=>{"use strict";r.d(t,{Ho:()=>d,gK:()=>n,l8:()=>s}),r(13664);var a=r(28371),d=(0,a.$)("6c43d88ae8971d644bac3e238c27c4174aed9a8b");(0,a.$)("7dab10352a8648ac19256d750c384fc5df404edf");var n=(0,a.$)("927139672bcde43876d6d45f34b0278362ff1819"),s=(0,a.$)("99bef74b7d73cf06e04d005b22478077a45eba3c");(0,a.$)("efb38be62ab00719db57928149e6461da7be13bc")},12634:(e,t,r)=>{"use strict";r.d(t,{f:()=>d,g:()=>n});var a=r(29709);let d=a.Ry({thread:a.Z_().nonempty().min(3,{message:"Minimum 3 characters."}),accountId:a.Z_()}),n=a.Ry({thread:a.Z_().nonempty().min(3,{message:"Minimum 3 characters."})})},31380:(e,t,r)=>{"use strict";r.r(t),r.d(t,{default:()=>f});var a=r(25036),d=r(78502),n=r(44551),s=r(86840);let i=(0,r(86843).createProxy)(String.raw`C:\Users\pmish\Desktop\threads\components\forms\PostThread.tsx`),{__esModule:o,$$typeof:c}=i,l=i.default;r(40002);let f=async()=>{let e=await (0,d.ar)();if(!e)return null;let t=await (0,s.fetchUser)(e.id);return t?.onboarded?(0,a.jsxs)(a.Fragment,{children:[a.jsx("div",{className:"head-text",children:"Create Thread"}),a.jsx(l,{userId:t._id})]}):(0,n.redirect)("/onboarding")}},98268:(e,t,r)=>{"use strict";r.r(t),r.d(t,{addCommentToThread:()=>b,createThread:()=>l,deleteThread:()=>u,fetchPosts:()=>c,fetchThreadById:()=>m});var a=r(98601);r(75811);var d=r(43811),n=r(35780),s=r(10510),i=r(59395),o=r(8974);async function c(e=1,t=20){(0,n.connectToDB)();let r=(e-1)*t,a=i.default.find({parentId:{$in:[null,void 0]}}).sort({createdAt:"desc"}).skip(r).limit(t).populate({path:"author",model:s.default}).populate({path:"community",model:o.default}).populate({path:"children",populate:{path:"author",model:s.default,select:"_id name parentId image"}}),d=await i.default.countDocuments({parentId:{$in:[null,void 0]}}),c=await a.exec(),l=d>r+c.length;return{posts:c,isNext:l}}async function l({text:e,author:t,communityId:r,path:a}){try{(0,n.connectToDB)();let c=await o.default.findOne({id:r},{_id:1}),l=await i.default.create({text:e,author:t,community:c});await s.default.findByIdAndUpdate(t,{$push:{threads:l._id}}),c&&await o.default.findByIdAndUpdate(c,{$push:{threads:l._id}}),(0,d.revalidatePath)(a)}catch(e){throw Error(`Failed to create thread: ${e.message}`)}}async function f(e){let t=await i.default.find({parentId:e}),r=[];for(let e of t){let t=await f(e._id);r.push(e,...t)}return r}async function u(e,t){try{(0,n.connectToDB)();let r=await i.default.findById(e).populate("author community");if(!r)throw Error("Thread not found");let a=await f(e),c=[e,...a.map(e=>e._id)],l=new Set([...a.map(e=>e.author?._id?.toString()),r.author?._id?.toString()].filter(e=>void 0!==e)),u=new Set([...a.map(e=>e.community?._id?.toString()),r.community?._id?.toString()].filter(e=>void 0!==e));await i.default.deleteMany({_id:{$in:c}}),await s.default.updateMany({_id:{$in:Array.from(l)}},{$pull:{threads:{$in:c}}}),await o.default.updateMany({_id:{$in:Array.from(u)}},{$pull:{threads:{$in:c}}}),(0,d.revalidatePath)(t)}catch(e){throw Error(`Failed to delete thread: ${e.message}`)}}async function m(e){(0,n.connectToDB)();try{return await i.default.findById(e).populate({path:"author",model:s.default,select:"_id id name image"}).populate({path:"community",model:o.default,select:"_id id name image"}).populate({path:"children",populate:[{path:"author",model:s.default,select:"_id id name parentId image"},{path:"children",model:i.default,populate:{path:"author",model:s.default,select:"_id id name parentId image"}}]}).exec()}catch(e){throw console.error("Error while fetching thread:",e),Error("Unable to fetch thread")}}async function b(e,t,r,a){(0,n.connectToDB)();try{let n=await i.default.findById(e);if(!n)throw Error("Thread not found");let s=new i.default({text:t,author:r,parentId:e}),o=await s.save();n.children.push(o._id),await n.save(),(0,d.revalidatePath)(a)}catch(e){throw console.error("Error while adding comment:",e),Error("Unable to add comment")}}(0,r(46893).ensureServerEntryExports)([c,l,u,m,b]),(0,a.createActionProxy)("7dab10352a8648ac19256d750c384fc5df404edf",c),(0,a.createActionProxy)("927139672bcde43876d6d45f34b0278362ff1819",l),(0,a.createActionProxy)("99bef74b7d73cf06e04d005b22478077a45eba3c",u),(0,a.createActionProxy)("efb38be62ab00719db57928149e6461da7be13bc",m),(0,a.createActionProxy)("6c43d88ae8971d644bac3e238c27c4174aed9a8b",b)},8974:(e,t,r)=>{"use strict";r.d(t,{default:()=>s});var a=r(11185),d=r.n(a);let n=new(d()).Schema({id:{type:String,required:!0},username:{type:String,unique:!0,required:!0},name:{type:String,required:!0},image:String,bio:String,createdBy:{type:d().Schema.Types.ObjectId,ref:"User"},threads:[{type:d().Schema.Types.ObjectId,ref:"Thread"}],members:[{type:d().Schema.Types.ObjectId,ref:"User"}]}),s=d().models.Community||d().model("Community",n)},59395:(e,t,r)=>{"use strict";r.d(t,{default:()=>s});var a=r(11185),d=r.n(a);let n=new(d()).Schema({text:{type:String,required:!0},author:{type:d().Schema.Types.ObjectId,ref:"User",required:!0},community:{type:d().Schema.Types.ObjectId,ref:"Community"},createdAt:{type:Date,default:Date.now},parentId:{type:String},children:[{type:d().Schema.Types.ObjectId,ref:"Thread"}]}),s=d().models.Thread||d().model("Thread",n)},10510:(e,t,r)=>{"use strict";r.d(t,{default:()=>s});var a=r(11185),d=r.n(a);let n=new(d()).Schema({id:{type:String,required:!0},username:{type:String,unique:!0,required:!0},name:{type:String,required:!0},image:String,bio:String,threads:[{type:d().Schema.Types.ObjectId,ref:"Thread"}],onboarded:{type:Boolean,default:!1},communities:[{type:d().Schema.Types.ObjectId,ref:"Community"}]}),s=d().models.User||d().model("User",n)},35780:(e,t,r)=>{"use strict";r.d(t,{connectToDB:()=>s});var a=r(11185),d=r.n(a);let n=!1,s=async()=>{if(d().set("strictQuery",!0),!process.env.MONGODB_URL)return console.log("Missing MongoDB URL");if(n){console.log("MongoDB connection already established");return}try{await d().connect(process.env.MONGODB_URL),n=!0,console.log("MongoDB connected")}catch(e){console.log(e)}}}};var t=require("../../../webpack-runtime.js");t.C(e);var r=e=>t(t.s=e),a=t.X(0,[638,661,502,356,437,500,819,39,355,674,245],()=>r(15828));module.exports=a})();